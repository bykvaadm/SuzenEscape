#!/bin/bash
NETWORK=none
if [[ $(whoami) =~ ^({{ levels | selectattr('servers', 'defined') | map(attribute='name') | join('|') }})$ ]]; then
  NETWORK=$(whoami)_network_$RANDOM
  docker network create --internal ${NETWORK} 2>&1 1>/dev/null
  /usr/bin/docker run -d --rm --network $NETWORK --name $(whoami)server \
    --cpus=".2" --memory=500m --kernel-memory=50m --pids-limit=50 \
    {{ registry_host }}/suzenescape/$(whoami)server 2>/dev/null 1>/dev/null
fi

/usr/bin/docker run -ti --rm --network $NETWORK --name $(whoami) \
  --cpus=".2" --memory=50m --kernel-memory=50m --pids-limit=50 \
  {{ registry_host }}/suzenescape/$(whoami) 2>/dev/null

docker network rm ${NETWORK} 2>&1 1>/dev/null
